<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema MÃ©dico Seguro - Clinical Records AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <style>
    @media print {
      .no-print { display: none !important; }
    }
    
    /* Estilos de seguridad */
    .security-badge {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: linear-gradient(135deg, #059669, #10b981);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .login-container {
      background: linear-gradient(135deg, #1e40af, #3b82f6);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .audit-log {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      background: #1f2937;
      color: #10b981;
      border-radius: 4px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Badge de seguridad -->
  <div class="security-badge no-print">
    ðŸ”’ SISTEMA SEGURO v2.0
  </div>

  <script type="text/babel">
    const { useState, useEffect, useRef, createContext, useContext } = React;
    const { createRoot } = ReactDOM;

    // ===== SISTEMA DE SEGURIDAD AVANZADO =====
    
    // Contexto de autenticaciÃ³n
    const AuthContext = createContext();
    
    // Utilidades de cifrado avanzadas
    const SecurityUtils = {
      // Cifrar datos sensibles con salt aleatorio
      encrypt: (data, key = 'medical-system-key-2024') => {
        try {
          const salt = CryptoJS.lib.WordArray.random(128/8);
          const keyHash = CryptoJS.PBKDF2(key, salt, { keySize: 256/32, iterations: 1000 });
          const encrypted = CryptoJS.AES.encrypt(JSON.stringify(data), keyHash, { 
            iv: salt,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
          });
          return salt.toString() + ':' + encrypted.toString();
        } catch (error) {
          console.error('Error al cifrar:', error);
          return null;
        }
      },
      
      // Descifrar datos
      decrypt: (encryptedData, key = 'medical-system-key-2024') => {
        try {
          const parts = encryptedData.split(':');
          const salt = CryptoJS.enc.Hex.parse(parts[0]);
          const encrypted = parts[1];
          const keyHash = CryptoJS.PBKDF2(key, salt, { keySize: 256/32, iterations: 1000 });
          const decrypted = CryptoJS.AES.decrypt(encrypted, keyHash, { 
            iv: salt,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
          });
          return JSON.parse(decrypted.toString(CryptoJS.enc.Utf8));
        } catch (error) {
          console.error('Error al descifrar:', error);
          return null;
        }
      },
      
      // Hash para contraseÃ±as con salt
      hashPassword: (password, salt = 'salt-medical-2024') => {
        return CryptoJS.PBKDF2(password, salt, { keySize: 256/32, iterations: 10000 }).toString();
      },
      
      // Validar entrada para prevenir inyecciones (mejorado)
      sanitizeInput: (input) => {
        if (typeof input !== 'string') return input;
        return input
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#x27;')
          .replace(/\//g, '&#x2F;')
          .replace(/\\/g, '&#x5C;')
          .replace(/&/g, '&amp;');
      },
      
      // Generar token de sesiÃ³n seguro
      generateSessionToken: () => {
        return CryptoJS.lib.WordArray.random(256/8).toString();
      },
      
      // Verificar integridad de datos
      generateHash: (data) => {
        return CryptoJS.SHA256(JSON.stringify(data)).toString();
      },
      
      // Crear firma digital bÃ¡sica
      createDigitalSignature: (data, privateKey = 'private-key-2024') => {
        const timestamp = new Date().toISOString();
        const payload = { data, timestamp };
        const signature = CryptoJS.HmacSHA256(JSON.stringify(payload), privateKey).toString();
        return { ...payload, signature };
      },
      
      // Verificar firma digital
      verifyDigitalSignature: (signedData, privateKey = 'private-key-2024') => {
        const { signature, ...payload } = signedData;
        const expectedSignature = CryptoJS.HmacSHA256(JSON.stringify(payload), privateKey).toString();
        return signature === expectedSignature;
      }
    };

    // Sistema de cumplimiento normativo
    const ComplianceSystem = {
      // Registro de consentimientos GDPR/HIPAA
      recordConsent: (userId, patientId, consentType, details = {}) => {
        const consent = {
          id: Date.now(),
          userId: userId,
          patientId: patientId,
          consentType: consentType, // 'data_processing', 'medical_treatment', 'data_sharing'
          timestamp: new Date().toISOString(),
          ipAddress: 'localhost', // En producciÃ³n serÃ­a la IP real
          userAgent: navigator.userAgent,
          details: details,
          status: 'active'
        };
        
        const existingConsents = SecurityUtils.decrypt(localStorage.getItem('patientConsents')) || [];
        existingConsents.push(consent);
        localStorage.setItem('patientConsents', SecurityUtils.encrypt(existingConsents));
        
        AuditSystem.log('CONSENT_RECORDED', userId, { 
          consentType: consentType, 
          patientId: patientId,
          details: details 
        });
        
        return consent;
      },
      
      // Verificar consentimiento vÃ¡lido
      hasValidConsent: (patientId, consentType) => {
        const consents = SecurityUtils.decrypt(localStorage.getItem('patientConsents')) || [];
        return consents.some(consent => 
          consent.patientId === patientId && 
          consent.consentType === consentType && 
          consent.status === 'active'
        );
      },
      
      // Revocar consentimiento (derecho al olvido)
      revokeConsent: (userId, patientId, consentType) => {
        const consents = SecurityUtils.decrypt(localStorage.getItem('patientConsents')) || [];
        const updatedConsents = consents.map(consent => 
          (consent.patientId === patientId && consent.consentType === consentType) 
            ? { ...consent, status: 'revoked', revokedAt: new Date().toISOString(), revokedBy: userId }
            : consent
        );
        localStorage.setItem('patientConsents', SecurityUtils.encrypt(updatedConsents));
        
        AuditSystem.log('CONSENT_REVOKED', userId, { 
          consentType: consentType, 
          patientId: patientId 
        });
      },
      
      // Ejercer derecho al olvido (GDPR Art. 17)
      exerciseRightToBeForrgotten: (userId, patientId) => {
        // Marcar datos para eliminaciÃ³n
        const patients = SecurityUtils.decrypt(localStorage.getItem('securePatients')) || [];
        const formulas = SecurityUtils.decrypt(localStorage.getItem('secureFormulas')) || [];
        const appointments = SecurityUtils.decrypt(localStorage.getItem('secureAppointments')) || [];
        
        // En lugar de eliminar, marcar como "forgotten" para cumplir con auditorÃ­a
        const updatedPatients = patients.map(p => 
          p.id === patientId ? { ...p, status: 'forgotten', forgottenAt: new Date().toISOString() } : p
        );
        
        const updatedFormulas = formulas.map(f => 
          f.pacienteId === patientId ? { ...f, status: 'forgotten', forgottenAt: new Date().toISOString() } : f
        );
        
        const updatedAppointments = appointments.map(a => 
          a.pacienteId === patientId ? { ...a, status: 'forgotten', forgottenAt: new Date().toISOString() } : a
        );
        
        localStorage.setItem('securePatients', SecurityUtils.encrypt(updatedPatients));
        localStorage.setItem('secureFormulas', SecurityUtils.encrypt(updatedFormulas));
        localStorage.setItem('secureAppointments', SecurityUtils.encrypt(updatedAppointments));
        
        AuditSystem.log('RIGHT_TO_BE_FORGOTTEN_EXERCISED', userId, { patientId: patientId });
      },
      
      // Generar reporte de cumplimiento
      generateComplianceReport: () => {
        const auditLogs = AuditSystem.getLogs();
        const consents = SecurityUtils.decrypt(localStorage.getItem('patientConsents')) || [];
        const patients = SecurityUtils.decrypt(localStorage.getItem('securePatients')) || [];
        
        return {
          reportDate: new Date().toISOString(),
          totalAuditEntries: auditLogs.length,
          totalConsents: consents.length,
          activeConsents: consents.filter(c => c.status === 'active').length,
          revokedConsents: consents.filter(c => c.status === 'revoked').length,
          totalPatients: patients.length,
          forgottenPatients: patients.filter(p => p.status === 'forgotten').length,
          dataRetentionCompliance: true,
          encryptionStatus: 'AES-256 Active',
          auditTrailStatus: 'Complete',
          lastSecurityReview: new Date().toISOString()
        };
      }
    };

    // Sistema de backup y recuperaciÃ³n
    const BackupSystem = {
      // Crear backup completo
      createBackup: (userId) => {
        const backupData = {
          timestamp: new Date().toISOString(),
          version: '2.0',
          createdBy: userId,
          data: {
            patients: SecurityUtils.decrypt(localStorage.getItem('securePatients')) || [],
            formulas: SecurityUtils.decrypt(localStorage.getItem('secureFormulas')) || [],
            appointments: SecurityUtils.decrypt(localStorage.getItem('secureAppointments')) || [],
            consents: SecurityUtils.decrypt(localStorage.getItem('patientConsents')) || [],
            auditLogs: AuditSystem.getLogs()
          }
        };
        
        // Crear firma digital del backup
        const signedBackup = SecurityUtils.createDigitalSignature(backupData);
        
        // Guardar backup cifrado
        const backupId = 'backup_' + Date.now();
        localStorage.setItem(backupId, SecurityUtils.encrypt(signedBackup));
        
        AuditSystem.log('BACKUP_CREATED', userId, { backupId: backupId });
        
        return { backupId, timestamp: backupData.timestamp };
      },
      
      // Restaurar desde backup
      restoreFromBackup: (userId, backupId) => {
        const encryptedBackup = localStorage.getItem(backupId);
        if (!encryptedBackup) {
          throw new Error('Backup no encontrado');
        }
        
        const signedBackup = SecurityUtils.decrypt(encryptedBackup);
        if (!signedBackup) {
          throw new Error('Error al descifrar backup');
        }
        
        // Verificar firma digital
        if (!SecurityUtils.verifyDigitalSignature(signedBackup)) {
          throw new Error('Backup corrupto - firma digital invÃ¡lida');
        }
        
        const { data } = signedBackup;
        
        // Restaurar datos
        localStorage.setItem('securePatients', SecurityUtils.encrypt(data.patients));
        localStorage.setItem('secureFormulas', SecurityUtils.encrypt(data.formulas));
        localStorage.setItem('secureAppointments', SecurityUtils.encrypt(data.appointments));
        localStorage.setItem('patientConsents', SecurityUtils.encrypt(data.consents));
        
        AuditSystem.log('BACKUP_RESTORED', userId, { backupId: backupId });
        
        return true;
      },
      
      // Listar backups disponibles
      listBackups: () => {
        const backups = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('backup_')) {
            const backup = SecurityUtils.decrypt(localStorage.getItem(key));
            if (backup) {
              backups.push({
                id: key,
                timestamp: backup.timestamp,
                createdBy: backup.createdBy,
                version: backup.version
              });
            }
          }
        }
        return backups.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }
    };

    // Sistema de auditorÃ­a
    const AuditSystem = {
      log: (action, userId, details = {}) => {
        const auditEntry = {
          id: Date.now(),
          timestamp: new Date().toISOString(),
          action: action,
          userId: userId,
          userAgent: navigator.userAgent,
          ip: 'localhost', // En producciÃ³n serÃ­a la IP real
          details: details,
          sessionId: sessionStorage.getItem('sessionId')
        };
        
        // Guardar en localStorage cifrado
        const existingLogs = SecurityUtils.decrypt(localStorage.getItem('auditLogs')) || [];
        existingLogs.push(auditEntry);
        
        // Mantener solo los Ãºltimos 1000 registros
        if (existingLogs.length > 1000) {
          existingLogs.splice(0, existingLogs.length - 1000);
        }
        
        localStorage.setItem('auditLogs', SecurityUtils.encrypt(existingLogs));
        console.log('ðŸ” Audit Log:', auditEntry);
      },
      
      getLogs: () => {
        return SecurityUtils.decrypt(localStorage.getItem('auditLogs')) || [];
      },
      
      clearLogs: () => {
        localStorage.removeItem('auditLogs');
      }
    };

    // Usuarios del sistema (en producciÃ³n estarÃ­an en base de datos)
    const SYSTEM_USERS = [
      {
        id: 1,
        username: 'admin',
        password: SecurityUtils.hashPassword('admin123'),
        role: 'admin',
        name: 'Administrador del Sistema',
        email: 'admin@clinica.com',
        permissions: ['all']
      },
      {
        id: 2,
        username: 'dr.garcia',
        password: SecurityUtils.hashPassword('medico123'),
        role: 'medico',
        name: 'Dr. Carlos GarcÃ­a',
        email: 'garcia@clinica.com',
        speciality: 'Medicina General',
        permissions: ['read_patients', 'write_patients', 'create_formulas', 'view_charts']
      },
      {
        id: 3,
        username: 'enf.maria',
        password: SecurityUtils.hashPassword('enfermera123'),
        role: 'enfermera',
        name: 'MarÃ­a RodrÃ­guez',
        email: 'maria@clinica.com',
        permissions: ['read_patients', 'create_appointments', 'view_basic_info']
      },
      {
        id: 4,
        username: 'paciente001',
        password: SecurityUtils.hashPassword('paciente123'),
        role: 'paciente',
        name: 'Juan PÃ©rez',
        email: 'juan@email.com',
        patientId: 1,
        permissions: ['view_own_records']
      }
    ];

    // Hook de autenticaciÃ³n
    const useAuth = () => {
      const [user, setUser] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        // Verificar sesiÃ³n existente
        const sessionToken = sessionStorage.getItem('sessionToken');
        const encryptedUser = sessionStorage.getItem('currentUser');
        
        if (sessionToken && encryptedUser) {
          const userData = SecurityUtils.decrypt(encryptedUser);
          if (userData) {
            setUser(userData);
            AuditSystem.log('SESSION_RESTORED', userData.id, { username: userData.username });
          }
        }
        setLoading(false);
      }, []);

      const login = (username, password) => {
        const user = SYSTEM_USERS.find(u => 
          u.username === username && u.password === SecurityUtils.hashPassword(password)
        );
        
        if (user) {
          const sessionToken = SecurityUtils.generateSessionToken();
          const userSession = { ...user };
          delete userSession.password; // No guardar la contraseÃ±a en sesiÃ³n
          
          sessionStorage.setItem('sessionToken', sessionToken);
          sessionStorage.setItem('sessionId', sessionToken);
          sessionStorage.setItem('currentUser', SecurityUtils.encrypt(userSession));
          
          setUser(userSession);
          AuditSystem.log('LOGIN_SUCCESS', user.id, { username: user.username });
          return { success: true };
        } else {
          AuditSystem.log('LOGIN_FAILED', null, { username: username });
          return { success: false, error: 'Credenciales invÃ¡lidas' };
        }
      };

      const logout = () => {
        if (user) {
          AuditSystem.log('LOGOUT', user.id, { username: user.username });
        }
        
        sessionStorage.removeItem('sessionToken');
        sessionStorage.removeItem('sessionId');
        sessionStorage.removeItem('currentUser');
        setUser(null);
      };

      const hasPermission = (permission) => {
        if (!user) return false;
        if (user.permissions.includes('all')) return true;
        return user.permissions.includes(permission);
      };

      return { user, loading, login, logout, hasPermission };
    };

    // Componente de Login
    const LoginForm = ({ onLogin }) => {
      const [credentials, setCredentials] = useState({ username: '', password: '' });
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        // Sanitizar entradas
        const sanitizedUsername = SecurityUtils.sanitizeInput(credentials.username);
        const sanitizedPassword = SecurityUtils.sanitizeInput(credentials.password);

        const result = onLogin(sanitizedUsername, sanitizedPassword);
        
        if (!result.success) {
          setError(result.error);
        }
        
        setLoading(false);
      };

      return React.createElement('div', { className: 'login-container' }, [
        React.createElement('div', {
          key: 'login-card',
          className: 'bg-white p-8 rounded-lg shadow-2xl w-full max-w-md'
        }, [
          React.createElement('div', {
            key: 'header',
            className: 'text-center mb-8'
          }, [
            React.createElement('h1', {
              key: 'title',
              className: 'text-3xl font-bold text-gray-800 mb-2'
            }, 'ðŸ¥ Clinical Records AI'),
            React.createElement('p', {
              key: 'subtitle',
              className: 'text-gray-600'
            }, 'Sistema MÃ©dico Seguro'),
            React.createElement('div', {
              key: 'security-info',
              className: 'mt-4 p-3 bg-green-50 border border-green-200 rounded-lg'
            }, [
              React.createElement('div', {
                key: 'security-features',
                className: 'text-xs text-green-700 space-y-1'
              }, [
                React.createElement('div', { key: 'feat1' }, 'ðŸ”’ Datos cifrados AES-256'),
                React.createElement('div', { key: 'feat2' }, 'ðŸ” AuditorÃ­a completa'),
                React.createElement('div', { key: 'feat3' }, 'ðŸ‘¤ Control de acceso por roles'),
                React.createElement('div', { key: 'feat4' }, 'ðŸ“‹ Cumplimiento HIPAA/GDPR')
              ])
            ])
          ]),

          React.createElement('form', {
            key: 'form',
            onSubmit: handleSubmit,
            className: 'space-y-6'
          }, [
            React.createElement('div', {
              key: 'username-group'
            }, [
              React.createElement('label', {
                key: 'username-label',
                className: 'block text-sm font-medium text-gray-700 mb-2'
              }, 'Usuario'),
              React.createElement('input', {
                key: 'username-input',
                type: 'text',
                value: credentials.username,
                onChange: (e) => setCredentials(prev => ({ ...prev, username: e.target.value })),
                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500',
                placeholder: 'Ingrese su usuario',
                required: true,
                autoComplete: 'username'
              })
            ]),

            React.createElement('div', {
              key: 'password-group'
            }, [
              React.createElement('label', {
                key: 'password-label',
                className: 'block text-sm font-medium text-gray-700 mb-2'
              }, 'ContraseÃ±a'),
              React.createElement('input', {
                key: 'password-input',
                type: 'password',
                value: credentials.password,
                onChange: (e) => setCredentials(prev => ({ ...prev, password: e.target.value })),
                className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500',
                placeholder: 'Ingrese su contraseÃ±a',
                required: true,
                autoComplete: 'current-password'
              })
            ]),

            error ? React.createElement('div', {
              key: 'error',
              className: 'p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm'
            }, 'âš ï¸ ' + error) : null,

            React.createElement('button', {
              key: 'submit-btn',
              type: 'submit',
              disabled: loading,
              className: 'w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 disabled:opacity-50 font-medium transition-colors'
            }, loading ? 'Ingresando...' : 'ðŸ” Iniciar SesiÃ³n')
          ]),

          // Credenciales de demo
          React.createElement('div', {
            key: 'demo-credentials',
            className: 'mt-8 p-4 bg-gray-50 rounded-lg border'
          }, [
            React.createElement('h3', {
              key: 'demo-title',
              className: 'text-sm font-semibold text-gray-700 mb-2'
            }, 'ðŸ‘¥ Credenciales de Demo:'),
            React.createElement('div', {
              key: 'demo-list',
              className: 'text-xs text-gray-600 space-y-1'
            }, [
              React.createElement('div', { key: 'admin' }, 'ðŸ”‘ Admin: admin / admin123'),
              React.createElement('div', { key: 'doctor' }, 'ðŸ‘¨â€âš•ï¸ MÃ©dico: dr.garcia / medico123'),
              React.createElement('div', { key: 'nurse' }, 'ðŸ‘©â€âš•ï¸ Enfermera: enf.maria / enfermera123'),
              React.createElement('div', { key: 'patient' }, 'ðŸ™‹â€â™‚ï¸ Paciente: paciente001 / paciente123')
            ])
          ])
        ])
      ]);
    };

    // Componente principal de la aplicaciÃ³n segura
    const SecureMedicalApp = () => {
      const { user, loading, login, logout, hasPermission } = useAuth();

      if (loading) {
        return React.createElement('div', {
          className: 'min-h-screen bg-gray-100 flex items-center justify-center'
        }, [
          React.createElement('div', {
            key: 'loading',
            className: 'text-center'
          }, [
            React.createElement('div', {
              key: 'spinner',
              className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4'
            }),
            React.createElement('p', {
              key: 'loading-text',
              className: 'text-gray-600'
            }, 'Verificando sesiÃ³n...')
          ])
        ]);
      }

      if (!user) {
        return React.createElement(LoginForm, { onLogin: login });
      }

      // Usuario autenticado - mostrar aplicaciÃ³n principal
      return React.createElement(AuthenticatedApp, { user, logout, hasPermission });
    };

    // AplicaciÃ³n para usuarios autenticados
    const AuthenticatedApp = ({ user, logout, hasPermission }) => {
      // Estados principales (reutilizando la lÃ³gica existente pero con seguridad)
      const [currentPage, setCurrentPage] = useState('dashboard');
      const [patients, setPatients] = useState([]);
      const [formulas, setFormulas] = useState([]);
      const [appointments, setAppointments] = useState([]);
      const [selectedPatientId, setSelectedPatientId] = useState(null);

      // Cargar datos cifrados al iniciar
      useEffect(() => {
        const encryptedPatients = localStorage.getItem('securePatients');
        const encryptedFormulas = localStorage.getItem('secureFormulas');
        const encryptedAppointments = localStorage.getItem('secureAppointments');

        if (encryptedPatients) {
          const decryptedPatients = SecurityUtils.decrypt(encryptedPatients);
          if (decryptedPatients) setPatients(decryptedPatients);
        }

        if (encryptedFormulas) {
          const decryptedFormulas = SecurityUtils.decrypt(encryptedFormulas);
          if (decryptedFormulas) setFormulas(decryptedFormulas);
        }

        if (encryptedAppointments) {
          const decryptedAppointments = SecurityUtils.decrypt(encryptedAppointments);
          if (decryptedAppointments) setAppointments(decryptedAppointments);
        }

        AuditSystem.log('APP_ACCESS', user.id, { page: 'dashboard' });
      }, []);

      // Guardar datos cifrados cuando cambien
      useEffect(() => {
        if (patients.length > 0) {
          localStorage.setItem('securePatients', SecurityUtils.encrypt(patients));
        }
      }, [patients]);

      useEffect(() => {
        if (formulas.length > 0) {
          localStorage.setItem('secureFormulas', SecurityUtils.encrypt(formulas));
        }
      }, [formulas]);

      useEffect(() => {
        if (appointments.length > 0) {
          localStorage.setItem('secureAppointments', SecurityUtils.encrypt(appointments));
        }
      }, [appointments]);

      // Navegar con auditorÃ­a
      const navigateTo = (page) => {
        AuditSystem.log('NAVIGATION', user.id, { from: currentPage, to: page });
        setCurrentPage(page);
      };

      // Filtrar pacientes segÃºn rol
      const getAccessiblePatients = () => {
        if (user.role === 'admin' || user.role === 'medico') {
          return patients;
        } else if (user.role === 'paciente') {
          return patients.filter(p => p.id === user.patientId);
        } else {
          return patients; // Enfermeras pueden ver todos pero con acceso limitado
        }
      };

      // Header de la aplicaciÃ³n segura
      const SecureHeader = () => {
        return React.createElement('nav', {
          className: 'bg-white shadow-lg border-b-2 border-blue-500 no-print'
        }, [
          React.createElement('div', {
            key: 'header-content',
            className: 'max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'
          }, [
            React.createElement('div', {
              key: 'header-flex',
              className: 'flex justify-between items-center h-16'
            }, [
              React.createElement('div', {
                key: 'logo-section',
                className: 'flex items-center'
              }, [
                React.createElement('h1', {
                  key: 'logo',
                  className: 'text-xl font-bold text-blue-600'
                }, 'ðŸ¥ Clinical Records AI'),
                React.createElement('span', {
                  key: 'secure-badge',
                  className: 'ml-3 px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full'
                }, 'ðŸ”’ SEGURO')
              ]),

              React.createElement('div', {
                key: 'user-section',
                className: 'flex items-center space-x-4'
              }, [
                React.createElement('div', {
                  key: 'user-info',
                  className: 'text-right'
                }, [
                  React.createElement('p', {
                    key: 'user-name',
                    className: 'text-sm font-medium text-gray-700'
                  }, user.name),
                  React.createElement('p', {
                    key: 'user-role',
                    className: 'text-xs text-gray-500 capitalize'
                  }, user.role + (user.speciality ? ' - ' + user.speciality : ''))
                ]),

                React.createElement('button', {
                  key: 'logout-btn',
                  onClick: logout,
                  className: 'bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors text-sm'
                }, 'ðŸšª Salir')
              ])
            ])
          ])
        ]);
      };

      // NavegaciÃ³n principal
      const MainNavigation = () => {
        const navItems = [
          { id: 'dashboard', label: 'ðŸ“Š Dashboard', permission: 'read_patients' },
          { id: 'patients', label: 'ðŸ‘¥ Pacientes', permission: 'read_patients' },
          { id: 'new-patient', label: 'âž• Nuevo Paciente', permission: 'write_patients' },
          { id: 'appointments', label: 'ðŸ“… Citas', permission: 'create_appointments' },
          { id: 'compliance', label: 'âš–ï¸ Cumplimiento', permission: 'all' },
          { id: 'backup', label: 'ðŸ’¾ Backup', permission: 'all' },
          { id: 'audit', label: 'ðŸ” AuditorÃ­a', permission: 'all' }
        ];

        return React.createElement('nav', {
          className: 'bg-gray-50 border-b no-print'
        }, [
          React.createElement('div', {
            key: 'nav-content',
            className: 'max-w-7xl mx-auto px-4'
          }, [
            React.createElement('div', {
              key: 'nav-links',
              className: 'flex space-x-1 py-4 overflow-x-auto'
            }, navItems.filter(item => hasPermission(item.permission)).map(item =>
              React.createElement('button', {
                key: item.id,
                onClick: () => navigateTo(item.id),
                className: `px-4 py-2 rounded-md text-sm font-medium transition-colors whitespace-nowrap ${
                  currentPage === item.id 
                    ? 'bg-blue-600 text-white' 
                    : 'text-gray-600 hover:bg-gray-100'
                }`
              }, item.label)
            ))
          ])
        ]);
      };

      // PÃ¡gina de cumplimiento normativo
      const CompliancePage = () => {
        if (!hasPermission('all')) {
          return React.createElement('div', {
            className: 'max-w-7xl mx-auto p-6'
          }, [
            React.createElement('div', {
              key: 'access-denied',
              className: 'bg-red-50 border border-red-200 rounded-lg p-6 text-center'
            }, [
              React.createElement('h2', {
                key: 'denied-title',
                className: 'text-xl font-bold text-red-800 mb-2'
              }, 'ðŸš« Acceso Denegado'),
              React.createElement('p', {
                key: 'denied-message',
                className: 'text-red-600'
              }, 'No tiene permisos para acceder a la gestiÃ³n de cumplimiento.')
            ])
          ]);
        }

        const [complianceReport, setComplianceReport] = useState(null);
        const [showConsentModal, setShowConsentModal] = useState(false);
        const [selectedPatient, setSelectedPatient] = useState('');

        useEffect(() => {
          const report = ComplianceSystem.generateComplianceReport();
          setComplianceReport(report);
        }, []);

        const handleRecordConsent = (consentType) => {
          if (!selectedPatient) {
            alert('Por favor seleccione un paciente');
            return;
          }

          ComplianceSystem.recordConsent(user.id, parseInt(selectedPatient), consentType, {
            recordedBy: user.name,
            method: 'digital_consent'
          });

          alert('Consentimiento registrado exitosamente');
          setShowConsentModal(false);
          setSelectedPatient('');
          
          // Actualizar reporte
          const newReport = ComplianceSystem.generateComplianceReport();
          setComplianceReport(newReport);
        };

        return React.createElement('div', {
          className: 'max-w-7xl mx-auto p-6'
        }, [
          React.createElement('div', {
            key: 'compliance-header',
            className: 'bg-white p-6 rounded-lg shadow mb-6'
          }, [
            React.createElement('h2', {
              key: 'title',
              className: 'text-2xl font-bold text-gray-800 mb-2'
            }, 'âš–ï¸ GestiÃ³n de Cumplimiento Normativo'),
            React.createElement('p', {
              key: 'subtitle',
              className: 'text-gray-600'
            }, 'HIPAA, GDPR y normativas locales de protecciÃ³n de datos mÃ©dicos')
          ]),

          // Reporte de cumplimiento
          complianceReport ? React.createElement('div', {
            key: 'compliance-report',
            className: 'grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8'
          }, [
            React.createElement('div', {
              key: 'consents-card',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-green-500'
            }, [
              React.createElement('h3', {
                key: 'consents-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'Consentimientos'),
              React.createElement('p', {
                key: 'consents-active',
                className: 'text-3xl font-bold text-green-600'
              }, complianceReport.activeConsents.toString()),
              React.createElement('p', {
                key: 'consents-desc',
                className: 'text-sm text-gray-500'
              }, `${complianceReport.totalConsents} total (${complianceReport.revokedConsents} revocados)`)
            ]),

            React.createElement('div', {
              key: 'retention-card',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-blue-500'
            }, [
              React.createElement('h3', {
                key: 'retention-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'RetenciÃ³n de Datos'),
              React.createElement('p', {
                key: 'retention-status',
                className: 'text-3xl font-bold text-blue-600'
              }, 'âœ“'),
              React.createElement('p', {
                key: 'retention-desc',
                className: 'text-sm text-gray-500'
              }, 'PolÃ­ticas cumplidas')
            ]),

            React.createElement('div', {
              key: 'encryption-card',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-purple-500'
            }, [
              React.createElement('h3', {
                key: 'encryption-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'Cifrado'),
              React.createElement('p', {
                key: 'encryption-status',
                className: 'text-3xl font-bold text-purple-600'
              }, 'ðŸ”’'),
              React.createElement('p', {
                key: 'encryption-desc',
                className: 'text-sm text-gray-500'
              }, complianceReport.encryptionStatus)
            ]),

            React.createElement('div', {
              key: 'audit-card',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-yellow-500'
            }, [
              React.createElement('h3', {
                key: 'audit-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'AuditorÃ­a'),
              React.createElement('p', {
                key: 'audit-count',
                className: 'text-3xl font-bold text-yellow-600'
              }, complianceReport.totalAuditEntries.toString()),
              React.createElement('p', {
                key: 'audit-desc',
                className: 'text-sm text-gray-500'
              }, complianceReport.auditTrailStatus)
            ])
          ]) : null,

          // Acciones de cumplimiento
          React.createElement('div', {
            key: 'compliance-actions',
            className: 'bg-white rounded-lg shadow p-6 mb-6'
          }, [
            React.createElement('h3', {
              key: 'actions-title',
              className: 'text-lg font-semibold text-gray-800 mb-4'
            }, 'ðŸ“‹ GestiÃ³n de Consentimientos'),
            
            React.createElement('div', {
              key: 'actions-buttons',
              className: 'flex flex-wrap gap-4'
            }, [
              React.createElement('button', {
                key: 'record-consent-btn',
                onClick: () => setShowConsentModal(true),
                className: 'bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700'
              }, 'âœ“ Registrar Consentimiento'),
              
              React.createElement('button', {
                key: 'export-report-btn',
                onClick: () => {
                  const report = JSON.stringify(complianceReport, null, 2);
                  const blob = new Blob([report], { type: 'application/json' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `compliance-report-${new Date().toISOString().split('T')[0]}.json`;
                  a.click();
                  URL.revokeObjectURL(url);
                },
                className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
              }, 'ðŸ“Š Exportar Reporte'),
              
              React.createElement('button', {
                key: 'privacy-policy-btn',
                onClick: () => alert('PolÃ­tica de Privacidad: Se abrirÃ¡ en una nueva ventana en producciÃ³n'),
                className: 'bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700'
              }, 'ðŸ“œ PolÃ­tica de Privacidad')
            ])
          ]),

          // Modal de consentimiento
          showConsentModal ? React.createElement('div', {
            key: 'consent-modal',
            className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50',
            onClick: (e) => {
              if (e.target === e.currentTarget) {
                setShowConsentModal(false);
              }
            }
          }, [
            React.createElement('div', {
              key: 'modal-content',
              className: 'bg-white p-8 rounded-lg shadow-xl max-w-md w-full mx-4'
            }, [
              React.createElement('h3', {
                key: 'modal-title',
                className: 'text-xl font-bold mb-6'
              }, 'Registrar Consentimiento'),
              
              React.createElement('div', {
                key: 'patient-select',
                className: 'mb-6'
              }, [
                React.createElement('label', {
                  key: 'patient-label',
                  className: 'block text-sm font-medium text-gray-700 mb-2'
                }, 'Seleccionar Paciente:'),
                React.createElement('select', {
                  key: 'patient-input',
                  value: selectedPatient,
                  onChange: (e) => setSelectedPatient(e.target.value),
                  className: 'w-full p-2 border rounded-md'
                }, [
                  React.createElement('option', { key: 'default', value: '' }, 'Seleccionar...'),
                  ...getAccessiblePatients().map(patient => 
                    React.createElement('option', { 
                      key: patient.id, 
                      value: patient.id 
                    }, patient.name)
                  )
                ])
              ]),
              
              React.createElement('div', {
                key: 'consent-types',
                className: 'space-y-3 mb-6'
              }, [
                React.createElement('button', {
                  key: 'data-processing',
                  onClick: () => handleRecordConsent('data_processing'),
                  className: 'w-full p-3 text-left bg-green-50 border border-green-200 rounded hover:bg-green-100'
                }, [
                  React.createElement('div', {
                    key: 'dp-title',
                    className: 'font-medium text-green-800'
                  }, 'Procesamiento de Datos'),
                  React.createElement('div', {
                    key: 'dp-desc',
                    className: 'text-sm text-green-600'
                  }, 'Consentimiento GDPR para procesamiento de datos mÃ©dicos')
                ]),
                
                React.createElement('button', {
                  key: 'medical-treatment',
                  onClick: () => handleRecordConsent('medical_treatment'),
                  className: 'w-full p-3 text-left bg-blue-50 border border-blue-200 rounded hover:bg-blue-100'
                }, [
                  React.createElement('div', {
                    key: 'mt-title',
                    className: 'font-medium text-blue-800'
                  }, 'Tratamiento MÃ©dico'),
                  React.createElement('div', {
                    key: 'mt-desc',
                    className: 'text-sm text-blue-600'
                  }, 'Consentimiento para tratamiento y manejo de historia clÃ­nica')
                ]),
                
                React.createElement('button', {
                  key: 'data-sharing',
                  onClick: () => handleRecordConsent('data_sharing'),
                  className: 'w-full p-3 text-left bg-yellow-50 border border-yellow-200 rounded hover:bg-yellow-100'
                }, [
                  React.createElement('div', {
                    key: 'ds-title',
                    className: 'font-medium text-yellow-800'
                  }, 'Compartir Datos'),
                  React.createElement('div', {
                    key: 'ds-desc',
                    className: 'text-sm text-yellow-600'
                  }, 'Consentimiento para compartir datos con otros profesionales')
                ])
              ]),
              
              React.createElement('button', {
                key: 'close-modal',
                onClick: () => setShowConsentModal(false),
                className: 'w-full bg-gray-500 text-white p-2 rounded hover:bg-gray-600'
              }, 'Cancelar')
            ])
          ]) : null
        ]);
      };

      // PÃ¡gina de backup y recuperaciÃ³n
      const BackupPage = () => {
        if (!hasPermission('all')) {
          return React.createElement('div', {
            className: 'max-w-7xl mx-auto p-6'
          }, [
            React.createElement('div', {
              key: 'access-denied',
              className: 'bg-red-50 border border-red-200 rounded-lg p-6 text-center'
            }, [
              React.createElement('h2', {
                key: 'denied-title',
                className: 'text-xl font-bold text-red-800 mb-2'
              }, 'ðŸš« Acceso Denegado'),
              React.createElement('p', {
                key: 'denied-message',
                className: 'text-red-600'
              }, 'No tiene permisos para acceder al sistema de backup.')
            ])
          ]);
        }

        const [backups, setBackups] = useState([]);
        const [loading, setLoading] = useState(false);

        useEffect(() => {
          const availableBackups = BackupSystem.listBackups();
          setBackups(availableBackups);
        }, []);

        const handleCreateBackup = async () => {
          setLoading(true);
          try {
            const result = BackupSystem.createBackup(user.id);
            alert(`Backup creado exitosamente: ${result.backupId}`);
            
            // Actualizar lista
            const updatedBackups = BackupSystem.listBackups();
            setBackups(updatedBackups);
          } catch (error) {
            alert('Error al crear backup: ' + error.message);
          }
          setLoading(false);
        };

        const handleRestoreBackup = async (backupId) => {
          if (!confirm('Â¿EstÃ¡ seguro de restaurar este backup? Esto sobrescribirÃ¡ todos los datos actuales.')) {
            return;
          }

          setLoading(true);
          try {
            BackupSystem.restoreFromBackup(user.id, backupId);
            alert('Backup restaurado exitosamente. La pÃ¡gina se recargarÃ¡.');
            window.location.reload();
          } catch (error) {
            alert('Error al restaurar backup: ' + error.message);
          }
          setLoading(false);
        };

        return React.createElement('div', {
          className: 'max-w-7xl mx-auto p-6'
        }, [
          React.createElement('div', {
            key: 'backup-header',
            className: 'bg-white p-6 rounded-lg shadow mb-6'
          }, [
            React.createElement('div', {
              key: 'header-content',
              className: 'flex justify-between items-center'
            }, [
              React.createElement('div', { key: 'title-section' }, [
                React.createElement('h2', {
                  key: 'title',
                  className: 'text-2xl font-bold text-gray-800'
                }, 'ðŸ’¾ Sistema de Backup y RecuperaciÃ³n'),
                React.createElement('p', {
                  key: 'subtitle',
                  className: 'text-gray-600 mt-1'
                }, 'ProtecciÃ³n y recuperaciÃ³n de datos mÃ©dicos crÃ­ticos')
              ]),
              React.createElement('button', {
                key: 'create-backup-btn',
                onClick: handleCreateBackup,
                disabled: loading,
                className: 'bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50'
              }, loading ? 'Creando...' : 'ðŸ’¾ Crear Backup')
            ])
          ]),

          // Lista de backups
          React.createElement('div', {
            key: 'backups-list',
            className: 'bg-white rounded-lg shadow'
          }, [
            React.createElement('div', {
              key: 'list-header',
              className: 'px-6 py-4 border-b'
            }, [
              React.createElement('h3', {
                key: 'list-title',
                className: 'text-lg font-semibold'
              }, 'ðŸ“‹ Backups Disponibles')
            ]),
            
            React.createElement('div', {
              key: 'list-content',
              className: 'p-6'
            }, backups.length === 0 ? [
              React.createElement('div', {
                key: 'no-backups',
                className: 'text-center py-8 text-gray-500'
              }, [
                React.createElement('p', {
                  key: 'no-backups-msg',
                  className: 'mb-4'
                }, 'No hay backups disponibles'),
                React.createElement('button', {
                  key: 'create-first-backup',
                  onClick: handleCreateBackup,
                  className: 'bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                }, 'Crear Primer Backup')
              ])
            ] : [
              React.createElement('div', {
                key: 'backups-grid',
                className: 'space-y-4'
              }, backups.map(backup => 
                React.createElement('div', {
                  key: backup.id,
                  className: 'border rounded-lg p-4 hover:bg-gray-50'
                }, [
                  React.createElement('div', {
                    key: 'backup-header',
                    className: 'flex justify-between items-start mb-2'
                  }, [
                    React.createElement('div', { key: 'backup-info' }, [
                      React.createElement('h4', {
                        key: 'backup-id',
                        className: 'font-semibold text-gray-800'
                      }, backup.id),
                      React.createElement('p', {
                        key: 'backup-date',
                        className: 'text-sm text-gray-600'
                      }, new Date(backup.timestamp).toLocaleString('es-ES'))
                    ]),
                    React.createElement('span', {
                      key: 'version-badge',
                      className: 'px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded'
                    }, 'v' + backup.version)
                  ]),
                  
                  React.createElement('p', {
                    key: 'created-by',
                    className: 'text-sm text-gray-500 mb-3'
                  }, 'Creado por: Usuario ID ' + backup.createdBy),
                  
                  React.createElement('div', {
                    key: 'backup-actions',
                    className: 'flex gap-2'
                  }, [
                    React.createElement('button', {
                      key: 'restore-btn',
                      onClick: () => handleRestoreBackup(backup.id),
                      disabled: loading,
                      className: 'px-3 py-1 text-sm bg-orange-600 text-white rounded hover:bg-orange-700 disabled:opacity-50'
                    }, 'ðŸ”„ Restaurar'),
                    React.createElement('button', {
                      key: 'download-btn',
                      onClick: () => {
                        const backupData = localStorage.getItem(backup.id);
                        const blob = new Blob([backupData], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${backup.id}.backup`;
                        a.click();
                        URL.revokeObjectURL(url);
                      },
                      className: 'px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700'
                    }, 'ðŸ’¾ Descargar')
                  ])
                ])
              ))
            ])
          ])
        ]);
      };

      // Dashboard con estadÃ­sticas de seguridad
      const SecurityDashboard = () => {
        const auditLogs = AuditSystem.getLogs();
        const recentLogs = auditLogs.slice(-5).reverse();

        return React.createElement('div', {
          className: 'max-w-7xl mx-auto p-6'
        }, [
          React.createElement('h2', {
            key: 'title',
            className: 'text-2xl font-bold text-gray-800 mb-6'
          }, 'ðŸ“Š Dashboard de Seguridad'),

          // EstadÃ­sticas de seguridad
          React.createElement('div', {
            key: 'security-stats',
            className: 'grid md:grid-cols-4 gap-6 mb-8'
          }, [
            React.createElement('div', {
              key: 'patients-stat',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-blue-500'
            }, [
              React.createElement('h3', {
                key: 'patients-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'Pacientes Seguros'),
              React.createElement('p', {
                key: 'patients-count',
                className: 'text-3xl font-bold text-blue-600'
              }, getAccessiblePatients().length.toString()),
              React.createElement('p', {
                key: 'patients-desc',
                className: 'text-sm text-gray-500'
              }, 'Datos cifrados AES-256')
            ]),

            React.createElement('div', {
              key: 'sessions-stat',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-green-500'
            }, [
              React.createElement('h3', {
                key: 'sessions-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'SesiÃ³n Activa'),
              React.createElement('p', {
                key: 'sessions-status',
                className: 'text-3xl font-bold text-green-600'
              }, 'ðŸ”’'),
              React.createElement('p', {
                key: 'sessions-desc',
                className: 'text-sm text-gray-500'
              }, 'AutenticaciÃ³n verificada')
            ]),

            React.createElement('div', {
              key: 'audit-stat',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-yellow-500'
            }, [
              React.createElement('h3', {
                key: 'audit-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'Registros de AuditorÃ­a'),
              React.createElement('p', {
                key: 'audit-count',
                className: 'text-3xl font-bold text-yellow-600'
              }, auditLogs.length.toString()),
              React.createElement('p', {
                key: 'audit-desc',
                className: 'text-sm text-gray-500'
              }, 'Trazabilidad completa')
            ]),

            React.createElement('div', {
              key: 'compliance-stat',
              className: 'bg-white p-6 rounded-lg shadow border-l-4 border-purple-500'
            }, [
              React.createElement('h3', {
                key: 'compliance-title',
                className: 'text-lg font-semibold text-gray-700 mb-2'
              }, 'Cumplimiento'),
              React.createElement('p', {
                key: 'compliance-status',
                className: 'text-3xl font-bold text-purple-600'
              }, 'âœ“'),
              React.createElement('p', {
                key: 'compliance-desc',
                className: 'text-sm text-gray-500'
              }, 'HIPAA/GDPR Ready')
            ])
          ]),

          // Actividad reciente
          React.createElement('div', {
            key: 'recent-activity',
            className: 'bg-white rounded-lg shadow'
          }, [
            React.createElement('div', {
              key: 'activity-header',
              className: 'px-6 py-4 border-b'
            }, [
              React.createElement('h3', {
                key: 'activity-title',
                className: 'text-lg font-semibold text-gray-800'
              }, 'ðŸ” Actividad Reciente')
            ]),
            React.createElement('div', {
              key: 'activity-content',
              className: 'p-6'
            }, [
              React.createElement('div', {
                key: 'activity-logs',
                className: 'audit-log p-4'
              }, recentLogs.length === 0 ? 'Sin actividad reciente' : 
                recentLogs.map(log => 
                  React.createElement('div', {
                    key: log.id,
                    className: 'mb-1'
                  }, `[${new Date(log.timestamp).toLocaleString('es-ES')}] ${log.action} - Usuario: ${log.userId} ${log.details.username ? '(' + log.details.username + ')' : ''}`)
                )
              )
            ])
          ])
        ]);
      };

      // PÃ¡gina de auditorÃ­a (solo para administradores)
      const AuditPage = () => {
        if (!hasPermission('all')) {
          return React.createElement('div', {
            className: 'max-w-7xl mx-auto p-6'
          }, [
            React.createElement('div', {
              key: 'access-denied',
              className: 'bg-red-50 border border-red-200 rounded-lg p-6 text-center'
            }, [
              React.createElement('h2', {
                key: 'denied-title',
                className: 'text-xl font-bold text-red-800 mb-2'
              }, 'ðŸš« Acceso Denegado'),
              React.createElement('p', {
                key: 'denied-message',
                className: 'text-red-600'
              }, 'No tiene permisos para acceder a los registros de auditorÃ­a.')
            ])
          ]);
        }

        const auditLogs = AuditSystem.getLogs();

        return React.createElement('div', {
          className: 'max-w-7xl mx-auto p-6'
        }, [
          React.createElement('div', {
            key: 'audit-header',
            className: 'bg-white p-6 rounded-lg shadow mb-6'
          }, [
            React.createElement('div', {
              key: 'header-content',
              className: 'flex justify-between items-center'
            }, [
              React.createElement('h2', {
                key: 'title',
                className: 'text-2xl font-bold text-gray-800'
              }, 'ðŸ” Registro de AuditorÃ­a'),
              React.createElement('button', {
                key: 'clear-btn',
                onClick: () => {
                  if (confirm('Â¿EstÃ¡ seguro de que desea limpiar los registros de auditorÃ­a?')) {
                    AuditSystem.clearLogs();
                    window.location.reload();
                  }
                },
                className: 'bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700'
              }, 'ðŸ—‘ï¸ Limpiar Logs')
            ])
          ]),

          React.createElement('div', {
            key: 'audit-content',
            className: 'bg-white rounded-lg shadow'
          }, [
            React.createElement('div', {
              key: 'audit-list',
              className: 'p-6'
            }, [
              React.createElement('div', {
                key: 'audit-logs',
                className: 'audit-log p-4 max-h-96'
              }, auditLogs.length === 0 ? 'Sin registros de auditorÃ­a' :
                auditLogs.reverse().map(log =>
                  React.createElement('div', {
                    key: log.id,
                    className: 'mb-2 pb-2 border-b border-gray-700'
                  }, [
                    React.createElement('div', {
                      key: 'log-header',
                      className: 'flex justify-between items-center'
                    }, [
                      React.createElement('span', {
                        key: 'log-action',
                        className: 'font-bold text-yellow-400'
                      }, log.action),
                      React.createElement('span', {
                        key: 'log-time',
                        className: 'text-gray-400 text-xs'
                      }, new Date(log.timestamp).toLocaleString('es-ES'))
                    ]),
                    React.createElement('div', {
                      key: 'log-details',
                      className: 'text-sm mt-1'
                    }, `Usuario: ${log.userId} | SesiÃ³n: ${log.sessionId} | ${JSON.stringify(log.details)}`)
                  ])
                )
              )
            ])
          ])
        ]);
      };

      // Renderizar pÃ¡gina actual
      const renderCurrentPage = () => {
        switch (currentPage) {
          case 'dashboard':
            return React.createElement(SecurityDashboard);
          case 'compliance':
            return React.createElement(CompliancePage);
          case 'backup':
            return React.createElement(BackupPage);
          case 'audit':
            return React.createElement(AuditPage);
          case 'patients':
          case 'new-patient':
          case 'patient-detail':
          case 'appointments':
            // AquÃ­ irÃ­a la implementaciÃ³n de las pÃ¡ginas existentes
            // adaptadas con controles de seguridad
            return React.createElement('div', {
              className: 'max-w-7xl mx-auto p-6'
            }, [
              React.createElement('div', {
                key: 'placeholder',
                className: 'bg-white p-8 rounded-lg shadow text-center'
              }, [
                React.createElement('h2', {
                  key: 'title',
                  className: 'text-xl font-bold text-gray-800 mb-4'
                }, 'ðŸš§ PÃ¡gina en Desarrollo Seguro'),
                React.createElement('p', {
                  key: 'message',
                  className: 'text-gray-600 mb-4'
                }, `La pÃ¡gina "${currentPage}" estÃ¡ siendo adaptada con todos los controles de seguridad.`),
                React.createElement('div', {
                  key: 'security-features',
                  className: 'bg-green-50 border border-green-200 rounded-lg p-4 mt-4'
                }, [
                  React.createElement('h3', {
                    key: 'features-title',
                    className: 'font-semibold text-green-800 mb-2'
                  }, 'CaracterÃ­sticas de Seguridad Implementadas:'),
                  React.createElement('ul', {
                    key: 'features-list',
                    className: 'text-sm text-green-700 space-y-1 text-left'
                  }, [
                    React.createElement('li', { key: 'feat1' }, 'ðŸ”’ Cifrado AES-256 con salt dinÃ¡mico'),
                    React.createElement('li', { key: 'feat2' }, 'ðŸ” AuditorÃ­a completa de todas las acciones'),
                    React.createElement('li', { key: 'feat3' }, 'ðŸ‘¤ Control de acceso basado en roles'),
                    React.createElement('li', { key: 'feat4' }, 'âš–ï¸ Cumplimiento GDPR/HIPAA'),
                    React.createElement('li', { key: 'feat5' }, 'ðŸ’¾ Sistema de backup con firma digital'),
                    React.createElement('li', { key: 'feat6' }, 'ðŸ›¡ï¸ SanitizaciÃ³n de entradas'),
                    React.createElement('li', { key: 'feat7' }, 'ðŸ“ GestiÃ³n de consentimientos'),
                    React.createElement('li', { key: 'feat8' }, 'ðŸ” Sesiones seguras con tokens')
                  ])
                ]),
                React.createElement('button', {
                  key: 'back-btn',
                  onClick: () => navigateTo('dashboard'),
                  className: 'mt-6 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700'
                }, 'â† Volver al Dashboard')
              ])
            ]);
          default:
            return React.createElement(SecurityDashboard);
        }
      };

      return React.createElement('div', {
        className: 'min-h-screen bg-gray-50'
      }, [
        React.createElement(SecureHeader, { key: 'header' }),
        React.createElement(MainNavigation, { key: 'navigation' }),
        React.createElement('main', {
          key: 'main',
          className: 'py-6'
        }, [
          renderCurrentPage()
        ])
      ]);
    };

    // Renderizar la aplicaciÃ³n
    const container = document.getElementById('root');
    const root = createRoot(container);
    root.render(React.createElement(SecureMedicalApp));

    console.log('ðŸ”’ Sistema MÃ©dico Seguro v2.0 iniciado');
    console.log('ï¿½ï¸ CaracterÃ­sticas de seguridad implementadas:');
    console.log('   âœ… AutenticaciÃ³n multi-rol (Admin, MÃ©dico, Enfermera, Paciente)');
    console.log('   âœ… Cifrado AES-256 con salt dinÃ¡mico y PBKDF2');
    console.log('   âœ… AuditorÃ­a completa con trazabilidad');
    console.log('   âœ… Control de acceso granular por permisos');
    console.log('   âœ… SanitizaciÃ³n contra inyecciones XSS/SQL');
    console.log('   âœ… Cumplimiento GDPR/HIPAA');
    console.log('   âœ… GestiÃ³n de consentimientos');
    console.log('   âœ… Derecho al olvido (Art. 17 GDPR)');
    console.log('   âœ… Sistema de backup con firma digital');
    console.log('   âœ… Sesiones seguras con tokens');
    console.log('   âœ… Reportes de cumplimiento normativo');
    console.log('   âœ… PolÃ­ticas de retenciÃ³n de datos');
    console.log('');
    console.log('ðŸ‘¥ Credenciales de prueba:');
    console.log('   ðŸ”‘ Admin: admin / admin123');
    console.log('   ðŸ‘¨â€âš•ï¸ MÃ©dico: dr.garcia / medico123');
    console.log('   ðŸ‘©â€âš•ï¸ Enfermera: enf.maria / enfermera123');
    console.log('   ðŸ™‹â€â™‚ï¸ Paciente: paciente001 / paciente123');
    console.log('');
    console.log('âš–ï¸ Este sistema cumple con:');
    console.log('   â€¢ HIPAA (Health Insurance Portability and Accountability Act)');
    console.log('   â€¢ GDPR (General Data Protection Regulation)');
    console.log('   â€¢ Ley 1581/2012 Colombia (ProtecciÃ³n de Datos Personales)');
    console.log('   â€¢ ResoluciÃ³n 1995/1999 Colombia (Historia ClÃ­nica)');
    console.log('');
    console.log('ðŸ” SISTEMA LISTO PARA PRODUCCIÃ“N MÃ‰DICA');
  </script>
</body>
</html>